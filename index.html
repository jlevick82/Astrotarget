<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AstroTarget v1.0</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    body { background-color: #0b0d17; color: #e0e0e0; font-family: Arial, sans-serif; }
    header { padding: 1rem; text-align: center; border-bottom: 1px solid #222; }
    .object-card { background: #1a1d29; border-radius: 8px; padding: 10px; margin: 10px; width: 250px; display: inline-block; vertical-align: top; }
    .object-card img { width: 100%; border-radius: 6px; }
    .object-card h5 { margin: 0.5rem 0; }
    #results { display: flex; flex-wrap: wrap; justify-content: center; }
    footer { text-align: center; padding: 1rem; margin-top: 2rem; font-size: 0.9em; color: #aaa; }
    .toast-container { position: fixed; bottom: 1rem; right: 1rem; }
  </style>
</head>
<body>
  <header>
    <h1>ğŸŒŒ AstroTarget</h1>
    <p>Find the best targets for tonight</p>
    <div id="gpsClock">âŒ› Loading time...</div>
    <div id="lightPollution">ğŸ’¡ Light Pollution Index: Loading...</div>
  </header>

  <!-- Filters -->
  <section class="container mt-3">
    <div class="row">
      <div class="col-md-4">
        <label>Min Altitude (Â°):</label>
        <input id="minAlt" type="number" class="form-control" value="20">
      </div>
      <div class="col-md-4">
        <label>Max Magnitude:</label>
        <input id="maxMag" type="number" class="form-control" value="9">
      </div>
      <div class="col-md-4">
        <label>Catalog:</label>
        <select id="catalogSelect" class="form-control">
          <option value="messier">Messier</option>
          <option value="caldwell">Caldwell</option>
          <option value="brightngc">Bright NGC</option>
          <option value="all">All</option>
        </select>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col text-center">
        <button class="btn btn-primary" onclick="applyFilters()">ğŸ”­ Apply Filters</button>
      </div>
    </div>
  </section>

  <!-- Results -->
  <section id="results" class="container mt-4"></section>

  <!-- APOD + ISS -->
  <section class="container mt-5">
    <h2>ğŸŒ  Astronomy Picture of the Day</h2>
    <iframe src="https://apod.nasa.gov/apod/astropix.html" width="100%" height="400" style="border:none;"></iframe>

    <h2 class="mt-4">ğŸ›° ISS Transit Planner</h2>
    <iframe src="https://transit-finder.com" width="100%" height="400" style="border:none;"></iframe>
  </section>

  <!-- Toast Notification -->
  <div class="toast-container position-fixed">
    <div id="settingsToast" class="toast bg-success text-white" role="alert">
      <div class="toast-body">âœ… Settings Applied!</div>
    </div>
  </div>
  <footer>
    <p>AstroTarget v1.0 â€“ All catalogs J2000 | <a href="docs/README.md" target="_blank">Docs</a></p>
  </footer>

  <!-- Scripts -->
  <script src="messier.js"></script>
  <script src="caldwell.js"></script>
  <script src="brightngc.js"></script>
  <script>
    let allCatalogs = { messier, caldwell, brightngc };

    // Render function
    function renderResults(objects) {
      const container = document.getElementById('results');
      container.innerHTML = "";
      if (!objects.length) {
        container.innerHTML = "<p class='text-center mt-3'>âŒ No objects match filters</p>";
        return;
      }
      objects.forEach(obj => {
        const card = document.createElement("div");
        card.className = "object-card";
        card.innerHTML = `
          <img src="${obj.img}" loading="lazy" onerror="this.src='images/placeholder.jpg'">
          <h5>${obj.name}</h5>
          <p>${obj.type}<br>
          Mag: ${obj.mag} | Size: ${obj.size}</p>
        `;
        container.appendChild(card);
      });
    }

    // Apply filters
    function applyFilters() {
      const minAlt = parseFloat(document.getElementById("minAlt").value);
      const maxMag = parseFloat(document.getElementById("maxMag").value);
      const catalogChoice = document.getElementById("catalogSelect").value;

      let objects = [];
      if (catalogChoice === "all") {
        objects = [...messier, ...caldwell, ...brightngc];
      } else {
        objects = allCatalogs[catalogChoice] || [];
      }

      // Placeholder altitude filter (real alt calculation can be added later)
      let filtered = objects.filter(o => o.mag <= maxMag);

      renderResults(filtered);

      // Show confirmation toast
      const toast = new bootstrap.Toast(document.getElementById("settingsToast"));
      toast.show();
    }

    // GPS Clock
    function updateClock() {
      const now = new Date();
      document.getElementById("gpsClock").textContent = "ğŸ•’ " + now.toLocaleString();
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Light Pollution (placeholder until API added)
    document.getElementById("lightPollution").textContent = "ğŸ’¡ Light Pollution Index: Moderate";

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/AstroTarget/service-worker.js")
      .then(() => console.log("Service Worker registered"))
      .catch(err => console.error("SW registration failed:", err));
  }
</script>

</body>
</html>

