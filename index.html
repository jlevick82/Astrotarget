<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Astrotarget</title>
<link rel="icon" href="favicon.ico">
<link rel="stylesheet" href="styles.css?v=18">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#000000">
</head>
<body>
<section class="splash">
  <img class="logo" src="assets/logo-1024.webp" alt="Astrotarget">
  <div class="overlay">
    <div class="progress"><div id="bar"></div></div>
    <ul id="debug" class="debug"></ul>
    <div class="row"><a class="btn" href="./Go-No-Go/">Skip</a></div>
  </div>
</section>
<script>
(function(){
  if (sessionStorage.getItem('gng.seenSplash') === '1') { location.replace('./Go-No-Go/'); return; }
  const qs = s => document.querySelector(s);
  const steps=[
    {label:'Environment ready', run:()=>Promise.resolve()},
    {label:'Storage OK', run:()=>{ localStorage.setItem('___t','1'); localStorage.removeItem('___t'); }},
    {label:'Timezone', run:()=>{ localStorage.setItem('gng.last.tz', Intl.DateTimeFormat().resolvedOptions().timeZone||''); }},
    {label:'Weather ping', run:()=> fetch('https://api.open-meteo.com/v1/forecast?latitude=0&longitude=0&hourly=cloud_cover&timezone=auto',{method:'HEAD'}).catch(()=>{}) }
  ];
  let p=0; const bar=qs('#bar'), dbg=qs('#debug');
  function row(label){ const li=document.createElement('li'); li.innerHTML='<div class="spin"></div><span>'+label+'</span>'; dbg.appendChild(li); return li; }
  (async()=>{
    for(const st of steps){ const li=row(st.label);
      try{ await st.run(); li.innerHTML=li.innerHTML+' <span style="color:#64d26d">OK</span>'; p+=100/steps.length; bar.style.width=p+'%'; }
      catch(e){ li.innerHTML=li.innerHTML+' <span style="color:#ff5d5d">FAIL</span>'; }
    }
    sessionStorage.setItem('gng.seenSplash','1'); setTimeout(()=>location.replace('./Go-No-Go/'),180);
  })();
})();
</script>
</body></html>
