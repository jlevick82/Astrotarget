(function(){'use strict';const $=(s,r=document)=>r.querySelector(s);const els={base:$('#baseUrl'),saveBase:$('#saveBase'),testPath:$('#testPath'),catalog:$('#catalog'),start:$('#startNum'),end:$('#endNum'),load:$('#loadBtn'),grid:$('#grid'),cardTpl:document.querySelector('#cardTpl')};function loadBaseUrl(){const saved=localStorage.getItem('astro.baseUrl'); if(els.base) els.base.value=saved||(window.__ASTRO_CONFIG__&&window.__ASTRO_CONFIG__.defaultBaseUrl||'')}function toast(msg){console.log(msg)}function nameFor(cat,n){return cat==='messier'?'m'+n:(cat==='caldwell'?'c'+n:'ngc'+n)}function makeUrl(cat,n){const base=(els.base.value||'').replace(/\\s+/g,'').trim(); if(!base)return'';const name=nameFor(cat,n); return base+name+'.jpg'}function cardElement(label){const node=els.cardTpl.content.cloneNode(true); node.querySelector('footer').textContent=label; return node;}async function loadRange(){els.grid.innerHTML=''; const start=Math.max(1,parseInt(els.start.value,10)||1); const end=Math.max(start,parseInt(els.end.value,10)||start); const cat=els.catalog.value; const max=cat==='messier'?110:(cat==='caldwell'?109:9999); const s=Math.min(start,max),e=Math.min(end,max); for(let n=s;n<=e;n++){const label=nameFor(cat,n).toUpperCase(); const node=cardElement(label); const img=node.querySelector('img'); const miss=node.querySelector('.missing'); let url=makeUrl(cat,n); try{const res=await fetch(url,{cache:'force-cache'}); if(res.ok&&(res.headers.get('content-type')||'').indexOf('image')>=0){img.src=URL.createObjectURL(await res.blob()); img.alt=label;} else {miss.style.display='block';}}catch(e){miss.style.display='block';} els.grid.appendChild(node);} }if(els.saveBase) els.saveBase.addEventListener('click',()=>{localStorage.setItem('astro.baseUrl',(els.base.value||'').trim());toast('Base URL saved')}); if(els.testPath) els.testPath.addEventListener('click',()=>toast('Test not implemented in minimal build')); if(els.load) els.load.addEventListener('click',loadRange); loadBaseUrl(); if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js?v=20').catch(()=>{}));}})();